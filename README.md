# Проект: Система аутентификации и авторизации

Данный проект реализует систему аутентификации и авторизации пользователей на FastAPI с поддержкой:

- Регистрации и управления пользователями
- Ролевой системы с гибкими правилами доступа
- CRUD операций для бизнес-ресурсов через ограничения доступа
- Безопасного хранения паролей и проверки токенов JWT

---

# Схема структуры управления ограничениями доступа

## Основные сущности

| Таблица               | Описание                                                   |
|-----------------------|------------------------------------------------------------|
| `users`               | Пользователи, каждый привязан к одной роли                |
| `roles`               | Набор ролей (admin, manager, user, guest)                 |
| `business_elements`   | Ресурсы приложения: users, access control, products, orders |
| `access_roles_rules`  | Правила доступа роли к конкретному ресурсу                |

## Типы разрешений

Для каждого ресурса определяются следующие поля:

| Поле                  | Описание                                                  |
|-----------------------|-----------------------------------------------------------|
| `read_permission`      | Может читать свои данные                                  |
| `read_all_permission`  | Может читать все данные                                   |
| `create_permission`    | Может создавать данные                                    |
| `update_permission`    | Может редактировать свои данные                           |
| `update_all_permission`| Может редактировать все данные                             |
| `delete_permission`    | Может удалять свои данные                                  |
| `delete_all_permission`| Может удалять все данные                                   |

## Проверка доступа

- Если пользователь **не найден** → `401 Unauthorized`
- Если пользователь **найден, но нет прав** → `403 Forbidden`
- Если пользователь **имеет право** → доступ разрешён

---

# Как запустить проект

## 1. Установка зависимостей

Проект использует [Poetry](https://python-poetry.org/) для управления зависимостями.  
Установите их командой:

```
poetry install
```

## 2. Настройка базы данных и миграции

Проект использует Alembic для управления миграциями базы данных.

1) Убедитесь, что настроена база данных postgres и DATABASE_URL прописан в .env файле проекта.
2) Примените миграции: 
```
poetry run alembic upgrade head
```

## 3. Запуск приложения
Для запуска FastAPI сервера используйте:
```
poetry run uvicorn src.main:app --reload
```
